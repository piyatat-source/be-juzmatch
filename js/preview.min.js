/*!
 * Detail Preview for PHPMaker v2022.7.0
 * Copyright (c) e.World Technology Limited. All rights reserved.
 */
!function(e,t){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=a(e),l=a(t);l.default.PREVIEW_TEMPLATE='<div class="ew-nav">\x3c!-- .ew-nav --\x3e\n    <ul class="nav nav-tabs" role="tablist"></ul>\n    <div class="tab-content">\x3c!-- .tab-content --\x3e\n        <div class="tab-pane fade" role="tabpanel"></div>\n    </div>\x3c!-- /.tab-content --\x3e\n</div>\x3c!-- /.ew-nav --\x3e',l.default.PREVIEW_LOADING_HTML='<div class="'+l.default.spinnerClass+' m-3 ew-loading" role="status"><span class="visually-hidden">'+l.default.language.phrase("Loading")+"</span></div>",l.default.PREVIEW_MODAL_HTML='<div id="ew-preview-dialog" class="'+l.default.PREVIEW_MODAL_CLASS+'" role="dialog" aria-hidden="true"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">'+l.default.language.phrase("CloseBtn")+"</button></div></div></div></div>",l.default.PREVIEW_MODAL_OPTIONS={},l.default.PREVIEW_MODAL_DIALOG=null,l.default.PREVIEW_OFFCANVAS_HTML='<div id="ew-preview-offcanvas" class="offcanvas offcanvas-'+l.default.PREVIEW_OFFCANVAS_PLACEMENT+'" data-bs-scroll="true" tabindex="-1" aria-labelledby="ew-preview-offcanvas-label"><div class="offcanvas-header"><h5 id="ew-preview-offcanvas-label">'+l.default.language.phrase("Details")+'</h5><button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body"></div></div>',l.default.PREVIEW_OFFCANVAS_OPTIONS={},l.default.PREVIEW_OFFCANVAS_SIDEBAR=null;let n=function(){let e=d.default(this).closest("tr"),t=e.is("tr[data-rowindex]")?e:e.closest("tr[data-rowindex]"),a=t.find("[class$=_preview] .ew-preview"),n=t.closest("table");if(t[0]&&a[0]){if("true"===t.attr("aria-expanded")){let e=function(e){let t,a=d.default(e),n=a.closest("tbody");l.default.PREVIEW_SINGLE_ROW&&(n.find("tr.ew-table-preview-row").remove(),n.find("tr[aria-expanded]").not(e).attr("aria-expanded","false"));let o=Array.from(e.cells).reduce(((e,t)=>e+t.colSpan),0),s=a.nextAll("tr[data-rowindex!="+a.data("rowindex")+"]").first();return s.hasClass("ew-table-preview-row")?s[0]:((t=n[0].insertRow(s[0]?s[0].sectionRowIndex:-1))&&(d.default(t).addClass("ew-table-preview-row expandable-body"),d.default(t.insertCell(0)).addClass("ew-table-last-col").prop("colSpan",o)),t)}(t[0]),n=d.default(e.cells[0]),o="target"+l.default.random();n.empty(),n.append(l.default.PREVIEW_TEMPLATE),n.children().slideUp(0),n.find(".nav-tabs, .nav-pills").append(a.find(".nav-item").clone(!0)),n.find(".tab-pane").attr("id",o),n.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+o,"aria-controls":o}).first().tab("show"),n.children().slideDown(500)}l.default.setupTable(-1,n[0],!0)}},o=function(e,t){var a;if(bootstrap.Popover.getInstance(t))return;let n=d.default(t.closest(".ew-list-option-body"));if(null==(a=bootstrap.Tooltip.getInstance(t))||a.dispose(),!(t=t.closest(l.default.PREVIEW_SELECTOR)))return;t.classList.contains("ew-preview-btn")||t.classList.add("ew-preview-btn");let o=new bootstrap.Popover(t,{html:!0,delay:l.default.PREVIEW_POPOVER_DELAY,placement:l.default.PREVIEW_POPOVER_PLACEMENT,container:document.getElementById("ew-tooltip"),content:l.default.PREVIEW_LOADING_HTML,sanitizeFn:l.default.sanitizeFn,customClass:"ew-preview-popover",trigger:"click"==l.default.PREVIEW_POPOVER_TRIGGER?"click":"manual"}),s=d.default(o.getTipElement());t.addEventListener("show.bs.popover",(()=>{var e;return null==(e=u())?void 0:e.hide()})),t.addEventListener("shown.bs.popover",(()=>{let e="target"+l.default.random();s.find(".popover-body").empty().html(l.default.PREVIEW_TEMPLATE),s.find(".nav-tabs, .nav-pills").append(n.find(".nav-item").clone(!0)),s.find(".tab-pane").attr("id",e),s.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+e,"aria-controls":e}).first().tab("show")})),"click"!=l.default.PREVIEW_POPOVER_TRIGGER&&t.addEventListener(l.default.PREVIEW_POPOVER_TRIGGER,(function(){var e;this.getAttribute("aria-describedby")||null==(e=bootstrap.Popover.getInstance(this))||e.show()}))},s=function(e,t){var a;null==(a=bootstrap.Tooltip.getInstance(t))||a.dispose(),(t=t.closest(l.default.PREVIEW_SELECTOR))&&(t.classList.contains("ew-preview-btn")||t.classList.add("ew-preview-btn"),t.addEventListener("click",(()=>{l.default.PREVIEW_MODAL_DIALOG.attr("data-parent-id",this.closest("[id^=el]").id).modal("hide"),l.default.PREVIEW_MODAL_DIALOG.modal("show")})))},i=function(e,t){var a;null==(a=bootstrap.Tooltip.getInstance(t))||a.dispose(),(t=t.closest(l.default.PREVIEW_SELECTOR))&&(t.classList.contains("ew-preview-btn")||t.classList.add("ew-preview-btn"),t.addEventListener("click",(()=>{l.default.PREVIEW_OFFCANVAS_SIDEBAR.attr("data-parent-id",this.closest("[id^=el]").id).offcanvas("hide"),l.default.PREVIEW_OFFCANVAS_SIDEBAR.offcanvas("show")})))},r=function(e){let t=e.currentTarget,a=t.dataset.bsTarget||t.closest(".tab-pane");if(!a)return;let n,o=d.default(t),s=d.default(a),i=t.dataset.url,f=o.data("start"),c=t.dataset.table,p=t.dataset.sort,v=t.dataset.sortOrder,b="";i?(n=s.data(c)||{},n.url=i,f=n.start||1,p=n.sort,v=n.sortOrder):f?(o.tooltip("hide"),n=s.data(c),i=n.url,n.start=f||1,p=n.sort,v=n.sortOrder):p&&(n=s.data(c),i=n.url,p!==n.sort||v!==n.sortOrder?n.start=f=1:f=n.start,n.sort=p,n.sortOrder=v),s.data(c,n).empty().html(l.default.PREVIEW_LOADING_HTML),d.default.isNumber(f)&&(b+="&start="+f),p&&(b+="&sort="+encodeURIComponent(p),["ASC","DESC","NO"].includes(v)&&(b+="&sortorder="+v),e.shiftKey&&!e.ctrlKey?b+="&cmd=resetsort":e.ctrlKey&&2==o.data("sortType")&&(b+="&ctrl=1")),d.default.get(i+b,(e=>{s.empty().html(e);let t=".ew-detail-btn-group[data-table='"+c+"'][data-url='"+i+"']",l=s.closest(".ew-nav").find(t);if(l[0]||(l=d.default("body").children(t)),l.is("div"))s.append(l.removeClass("d-none"));else if(l.is("ul")){let e=o.closest(".nav-item").addClass("dropdown"),t=e.find(".dropdown-toggle").addClass("active").removeClass("d-none");t[0]||(t=o.clone(),t.addClass("dropdown-toggle").attr({"data-bs-toggle":"dropdown","data-bs-target":null,role:"button"}),e.prepend(t),o.on("hide.bs.tab",(()=>{e.removeClass("dropdown").find(o).removeClass("d-none active"),e.find(".dropdown-toggle").addClass("d-none").removeClass("active show")}))),o.addClass("d-none")}s.find(".ew-pager .btn:not(.disabled), .ew-table-header > th > div[data-sort]").data({target:a,table:c}).on("click",r),d.default(document).trigger(d.default.Event("preview",{target:s[0],$tabpane:s}))})).done((()=>{var e,t;null==(e=u())||e.update();let a=document.querySelector("#ew-preview-dialog");null!=a&&a.classList.contains("show")&&(null==(t=bootstrap.Modal.getInstance(a))||t.handleUpdate())}))},f=function(e){d.default(e.currentTarget.dataset.bsTarget).find(".dropdown-toggle[id]").dropdown("dispose");let t=e.currentTarget.closest(".popover, .modal, .nav");t&&d.default(t).find(".dropdown-toggle").dropdown("hide")},u=()=>{let e=document.querySelector(".ew-preview-popover.show");if(!e)return null;let t=document.querySelector(".ew-preview-btn[aria-describedby='"+e.id+"']");return t?bootstrap.Popover.getInstance(t):null},c=function(e){l.default.lazyLoad(e),l.default.initPanels(e.$tabpane[0]),e.$tabpane.find("table.ew-table").each(l.default.setupTable),l.default.initTooltips(e),l.default.initLightboxes(e),l.default.initIcons(e)},p=function(e){var t;let a=null!=(t=null==e?void 0:e.target)?t:document;d.default(a).find("tr[data-rowindex][data-widget='expandable-table']").on("expanded.lte.expandableTable",n)},v=function(e){var t;let a=null!=(t=null==e?void 0:e.target)?t:document;d.default(a).find(".ew-preview [data-bs-toggle='tab']").on("show.bs.tab",r).on("hide.bs.tab",f)};Object.assign(l.default,{showPreviewRow:n,detailPopover:o,detailModal:s,detailOffcanvas:i}),d.default((function(){d.default(document).on("preview",c),l.default.PREVIEW_POPOVER?(d.default(".ew-preview-btn").each(o),document.addEventListener("click",(e=>{var t;e.target.closest(".ew-preview-popover")||null==(t=u())||t.hide()}))):l.default.PREVIEW_MODAL?(document.getElementById("ew-preview-dialog")||d.default("body").append(l.default.PREVIEW_MODAL_HTML),l.default.PREVIEW_MODAL_DIALOG=d.default("#ew-preview-dialog").modal(l.default.PREVIEW_MODAL_OPTIONS),d.default("#ew-preview-dialog").on("show.bs.modal",(function(){d.default(this).find(".modal-body").empty().html(l.default.PREVIEW_TEMPLATE)})).on("shown.bs.modal",(function(e){let t=d.default(this),a="target"+l.default.random();t.find(".nav-tabs, .nav-pills").append(d.default("#"+this.dataset.parentId).find(".nav-item").clone(!0)),t.find(".tab-pane").attr("id",a),t.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+a,"aria-controls":a}).first().tab("show")})),d.default(".ew-preview-btn").each(s)):l.default.PREVIEW_OFFCANVAS?(document.getElementById("ew-preview-offcanvas")||d.default("body").append(l.default.PREVIEW_OFFCANVAS_HTML),l.default.PREVIEW_OFFCANVAS_SIDEBAR=d.default("#ew-preview-offcanvas").offcanvas(l.default.PREVIEW_OFFCANVAS_OPTIONS),d.default("#ew-preview-offcanvas").on("show.bs.offcanvas",(function(){d.default(this).find(".offcanvas-body").empty().html(l.default.PREVIEW_TEMPLATE)})).on("shown.bs.offcanvas",(function(){let e=d.default(this),t="target"+l.default.random();e.find(".nav-tabs, .nav-pills").append(d.default("#"+this.dataset.parentId).find(".nav-item").clone(!0)),e.find(".tab-pane").attr("id",t),e.find("[data-bs-toggle='tab']").attr({"data-bs-target":"#"+t,"aria-controls":t}).first().tab("show")})),d.default(".ew-preview-btn").each(i)):l.default.PREVIEW_ROW&&p(),v(),d.default(".ew-multi-column-grid").on("layout",(function(e){l.default.PREVIEW_ROW&&p(e),v(e)}))}))}(jQuery,ew);
//# sourceMappingURL=preview.min.js.map